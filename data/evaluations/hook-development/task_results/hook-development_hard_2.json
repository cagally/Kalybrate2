{
  "task_id": "hook-development_hard_2",
  "prompt": "Create a plugin with hooks that automatically detects the project type (Node.js, Python, etc.) on session start, sets appropriate environment variables, validates tool usage based on project conventions, and blocks completion until proper documentation and tests are in place.",
  "difficulty": "hard",
  "model": "claude-3-5-haiku-20241022",
  "response": "I'll create a comprehensive plugin that demonstrates intelligent project detection, validation, and workflow enforcement. I'll break this down into multiple files within the plugin structure.\n\nLet's create the plugin in the OUTPUT_DIR with the following structure:\n1. `hooks/hooks.json` - Hook configuration\n2. `scripts/detect-project.sh` - Project type detection\n3. `scripts/validate-tool-use.sh` - Tool usage validation\n4. `scripts/validate-completion.sh` - Completion validation\n5. `README.md` - Plugin documentation\n6. `manifest.json` - Plugin metadata\n\nI'll use Python to create these files:\n\n```python\nimport os\nimport json\n\n# Ensure the output directory exists\nos.makedirs(OUTPUT_DIR, exist_ok=True)\nplugin_dir = os.path.join(OUTPUT_DIR, 'project-validator-plugin')\nos.makedirs(plugin_dir, exist_ok=True)\nos.makedirs(os.path.join(plugin_dir, 'hooks'), exist_ok=True)\nos.makedirs(os.path.join(plugin_dir, 'scripts'), exist_ok=True)\n\n# 1. hooks.json\nhooks_config = {\n    \"description\": \"Intelligent project validation and workflow enforcement plugin\",\n    \"hooks\": {\n        \"SessionStart\": [\n            {\n                \"matcher\": \"*\",\n                \"hooks\": [\n                    {\n                        \"type\": \"command\",\n                        \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/detect-project.sh\",\n                        \"timeout\": 15\n                    }\n                ]\n            }\n        ],\n        \"PreToolUse\": [\n            {\n                \"matcher\": \"*\",\n                \"hooks\": [\n                    {\n                        \"type\": \"command\",\n                        \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/validate-tool-use.sh\",\n                        \"timeout\": 20\n                    }\n                ]\n            }\n        ],\n        \"Stop\": [\n            {\n                \"matcher\": \"*\",\n                \"hooks\": [\n                    {\n                        \"type\": \"command\",\n                        \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/validate-completion.sh\",\n                        \"timeout\": 30\n                    }\n                ]\n            }\n        ]\n    }\n}\n\nwith open(os.path.join(plugin_dir, 'hooks', 'hooks.json'), 'w') as f:\n    json.dump(hooks_config, f, indent=2)\n\n# 2. detect-project.sh\ndetect_project_script = '''#!/bin/bash\nset -euo pipefail\n\n# Detect project type based on common files\ndetect_project_type() {\n    if [ -f \"package.json\" ]; then\n        echo \"nodejs\"\n    elif [ -f \"requirements.txt\" ] || [ -f \"setup.py\" ]; then\n        echo \"python\"\n    elif [ -f \"pom.xml\" ]; then\n        echo \"java\"\n    elif [ -f \"Cargo.toml\" ]; then\n        echo \"rust\"\n    else\n        echo \"unknown\"\n    fi\n}\n\nproject_type=$(detect_project_type)\n\n# Persist project type for future hooks\necho \"export PROJECT_TYPE=$project_type\" >> \"$CLAUDE_ENV_FILE\"\n\n# Output for logging\necho \"{\n    \\\\\"project_type\\\\\": \\\\\"$project_type\\\\\",\n    \\\\\"systemMessage\\\\\": \\\\\"Detected project type: $project_type\\\\\"\n}\"\n'''\n\nwith open(os.path.join(plugin_dir, 'scripts', 'detect-project.sh'), 'w') as f:\n    f.write(detect_project_script)\nos.chmod(os.path.join(plugin_dir, 'scripts', 'detect-project.sh'), 0o755)\n\n# 3. validate-tool-use.sh\nvalidate_tool_use_script = '''#!/bin/bash\nset -euo pipefail\n\ninput=$(cat)\ntool_name=$(echo \"$input\" | jq -r '.tool_name')\nproject_type=$(echo \"$input\" | jq -r '.env.PROJECT_TYPE // \"unknown\"')\n\n# Project-specific tool validation\ncase \"$project_type\" in\n    \"nodejs\")\n        if [[ \"$tool_name\" == \"Bash\" && \"$tool_input\" == *\"npm\"* ]]; then\n            # Require npm commands to run via package.json scripts\n            echo '{\"decision\": \"deny\", \"reason\": \"Use package.json scripts instead of direct npm commands\"}' >&2\n            exit 2\n        fi\n        ;;\n    \"python\")\n        if [[ \"$tool_name\" == \"Bash\" && \"$tool_input\" == *\"pip\"* ]]; then\n            # Require pip installs via requirements.txt\n            echo '{\"decision\": \"deny\", \"reason\": \"Use requirements.txt for dependency management\"}' >&2\n            exit 2\n        fi\n        ;;\nesac\n\n# Allow tool use by default\necho '{\"continue\": true}'\n'''\n\nwith open(os.path.join(plugin_dir, 'scripts', 'validate-tool-use.sh'), 'w') as f:\n    f.write(validate_tool_use_script)\nos.chmod(os.path.join(plugin_dir, 'scripts', 'validate-tool-use.sh'), 0o755)\n\n# 4. validate-completion.sh\nvalidate_completion_script = '''#!/bin/bash\nset -euo pipefail\n\nproject_type=$(echo \"$CLAUDE_PROJECT_TYPE\" | tr '[:upper:]' '[:lower:]')\n\n# Validation checklist based on project type\ncase \"$project_type\" in\n    \"nodejs\")\n        # Check README, tests, and documentation\n        if [ ! -f \"README.md\" ]; then\n            echo '{\"decision\": \"block\", \"reason\": \"Missing README.md\"}' >&2\n            exit 2\n        fi\n        if [ ! -d \"test\" ] && [ ! -d \"__tests__\" ]; then\n            echo '{\"decision\": \"block\", \"reason\": \"No test directory found. Add tests before completion.\"}' >&2\n            exit 2\n        fi\n        ;;\n    \"python\")\n        # Python-specific checks\n        if [ ! -f \"README.md\" ]; then\n            echo '{\"decision\": \"block\", \"reason\": \"Missing README.md\"}' >&2\n            exit 2\n        fi\n        if [ ! -d \"tests\" ]; then\n            echo '{\"decision\": \"block\", \"reason\": \"No tests directory found. Add tests before completion.\"}' >&2\n            exit 2\n        fi\n        ;;\n    *)\n        # Generic checks for unknown project types\n        if [ ! -f \"README.md\" ]; then\n            echo '{\"decision\": \"ask\", \"reason\": \"Consider adding a README.md\"}' >&2\n            exit 0\n        fi\n        ;;\nesac\n\n# All checks passed\necho '{\"decision\": \"approve\", \"reason\": \"Project meets completion requirements\"}'\n'''\n\nwith open(os.path.join(plugin_dir, 'scripts', 'validate-completion.sh'), 'w') as f:\n    f.write(validate_completion_script)\nos.chmod(os.path.join(plugin_dir, 'scripts', 'validate-completion.sh'), 0o755)\n\n# 5. README.md\nreadme_content = '''# Project Validator Plugin\n\n## Overview\nThis Claude Code plugin provides intelligent project validation and workflow enforcement:\n\n1. **Project Type Detection**: Automatically detects project type (Node.js, Python, etc.)\n2. **Tool Usage Validation**: Enforces project-specific best practices\n3. **Completion Validation**: Ensures documentation and tests are in place\n\n## Features\n- Auto-detect project type based on configuration files\n- Block direct package manager commands\n- Require documentation and tests before task completion\n\n## Supported Project Types\n- Node.js\n- Python\n- (Extensible for more project types)\n\n## Installation\n1. Clone this plugin\n2. Add to your Claude Code plugin directory\n3. Restart Claude Code session\n\n## Contributing\nContributions welcome! Please submit pull requests with additional project type validations.\n'''\n\nwith open(os.path.join(plugin_dir, 'README.md'), 'w') as f:\n    f.write(readme_content)\n\n# 6. manifest.json\nmanifest = {\n    \"name\": \"Project Validator\",\n    \"version\": \"0.1.0\",\n    \"description\": \"Intelligent project type detection and validation plugin\",\n    \"author\": \"Claude AI\",\n    \"license\": \"MIT\",\n    \"dependencies\": [],\n    \"hooks_supported\": [\"SessionStart\", \"PreToolUse\", \"Stop\"]\n}\n\nwith open(os.path.join(plugin_dir, 'manifest.json'), 'w') as f:\n    json.dump(manifest, f, indent=2)\n\nprint(f\"Plugin created successfully in {plugin_dir}\")\n```\n\nThis plugin provides a comprehensive solution for:\n1. Detecting project type automatically\n2. Setting environment variables based on project type\n3. Validating tool usage according to project conventions\n4. Blocking completion until proper documentation and tests are in place\n\nKey features:\n- Detects project types: Node.js, Python, Java, Rust\n- Validates tool usage (e.g., preventing direct npm/pip commands)\n- Requires README.md and tests before task completion\n- Provides informative error messages\n- Extensible design for future project types\n\nTo use this plugin:\n1. The scripts will run automatically during a Claude Code session\n2. It will detect your project type\n3. Enforce best practices during development\n4. Block completion if key requirements aren't met\n\nWould you like me to elaborate on any part of the plugin implementation?",
  "criteria_results": {
    "file_created": false,
    "file_valid": false,
    "file_has_content": false
  },
  "verification_notes": {
    "file_created": "verified",
    "file_valid": "verified - no file created",
    "file_has_content": "verified - no file created"
  },
  "verification_level": "full",
  "verified_criteria": {
    "passed": 0,
    "total": 1
  },
  "passed": false,
  "tokens": {
    "input": 4864,
    "output": 2349,
    "total": 7213
  },
  "execution_time": 33.069210052490234,
  "error": null,
  "timestamp": "2026-01-01T18:54:38.191937"
}