{
  "task_id": "pdf_hard_2",
  "prompt": "I need to create a multi-page PDF report with our company logo as a watermark on every page, plus extract all the images from an existing PDF to use in the new document.",
  "difficulty": "hard",
  "model": "claude-3-5-haiku-20241022",
  "response": "I'll provide a comprehensive solution that demonstrates extracting images from an existing PDF and creating a new multi-page PDF report with a watermark. Here's a complete script:\n\n```python\nimport os\nfrom reportlab.lib.pagesizes import letter\nfrom reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Image\nfrom reportlab.lib.styles import getSampleStyleSheet\nfrom pypdf import PdfReader, PdfWriter\nfrom pdf2image import convert_from_path\n\ndef extract_images_from_pdf(pdf_path, output_dir='extracted_images'):\n    \"\"\"\n    Extract all images from a PDF file.\n    \n    Args:\n        pdf_path (str): Path to the input PDF\n        output_dir (str): Directory to save extracted images\n    \n    Returns:\n        list: Paths to extracted images\n    \"\"\"\n    # Ensure output directory exists\n    os.makedirs(output_dir, exist_ok=True)\n    \n    # Use poppler-utils to extract images\n    import subprocess\n    \n    # Generate unique prefix to avoid overwriting\n    prefix = os.path.join(output_dir, 'image')\n    \n    # Extract images using pdfimages command\n    subprocess.run(['pdfimages', '-j', pdf_path, prefix], check=True)\n    \n    # Find all extracted images\n    extracted_images = [\n        os.path.join(output_dir, f) \n        for f in os.listdir(output_dir) \n        if f.startswith('image-') and f.endswith(('.jpg', '.jpeg', '.png', '.gif'))\n    ]\n    \n    return extracted_images\n\ndef create_watermarked_pdf(input_pdf, output_pdf, watermark_pdf):\n    \"\"\"\n    Add a watermark to every page of a PDF.\n    \n    Args:\n        input_pdf (str): Path to the input PDF\n        output_pdf (str): Path to save the watermarked PDF\n        watermark_pdf (str): Path to the watermark PDF\n    \"\"\"\n    # Read the input PDF and watermark\n    reader = PdfReader(input_pdf)\n    watermark = PdfReader(watermark_pdf).pages[0]\n    \n    # Create a new PDF writer\n    writer = PdfWriter()\n    \n    # Add watermark to each page\n    for page in reader.pages:\n        page.merge_page(watermark)\n        writer.add_page(page)\n    \n    # Write the watermarked PDF\n    with open(output_pdf, 'wb') as output_file:\n        writer.write(output_file)\n\ndef create_report_with_images(images, output_path='company_report.pdf', logo_path='company_logo.png'):\n    \"\"\"\n    Create a multi-page PDF report with images and a logo.\n    \n    Args:\n        images (list): List of image paths to include in the report\n        output_path (str): Path to save the PDF report\n        logo_path (str): Path to company logo\n    \"\"\"\n    # Prepare the document\n    doc = SimpleDocTemplate(output_path, pagesize=letter)\n    styles = getSampleStyleSheet()\n    story = []\n    \n    # Add company logo to the first page\n    if os.path.exists(logo_path):\n        logo = Image(logo_path, width=200, height=100)\n        logo.hAlign = 'CENTER'\n        story.append(logo)\n        story.append(Spacer(1, 12))\n    \n    # Add a title\n    title = Paragraph(\"Company Report\", styles['Title'])\n    story.append(title)\n    story.append(Spacer(1, 12))\n    \n    # Add extracted images to the report\n    for img_path in images:\n        try:\n            # Add image with some spacing\n            img = Image(img_path, width=400, height=300)\n            img.hAlign = 'CENTER'\n            story.append(img)\n            story.append(Spacer(1, 12))\n            \n            # Optional: Add filename as caption\n            caption = Paragraph(os.path.basename(img_path), styles['Caption'])\n            story.append(caption)\n            story.append(Spacer(1, 12))\n        except Exception as e:\n            print(f\"Could not add image {img_path}: {e}\")\n    \n    # Build the PDF\n    doc.build(story)\n    print(f\"Report created: {output_path}\")\n\ndef main():\n    # Paths (replace with your actual paths)\n    input_pdf = 'source_document.pdf'\n    logo_path = 'company_logo.png'\n    watermark_pdf = 'watermark.pdf'\n    \n    # Extract images from PDF\n    extracted_images = extract_images_from_pdf(input_pdf)\n    \n    # Create report with extracted images\n    create_report_with_images(extracted_images, logo_path=logo_path)\n    \n    # Optional: Create watermarked version of the report\n    create_watermarked_pdf('company_report.pdf', 'watermarked_report.pdf', watermark_pdf)\n\nif __name__ == '__main__':\n    main()\n```\n\n### Prerequisites and Setup\n\nBefore running this script, you'll need to install several dependencies:\n\n```bash\npip install reportlab pypdf pdf2image\n```\n\nYou'll also need some additional system tools:\n- poppler-utils (for pdfimages)\n- Tesseract OCR (optional, but helpful for image extraction)\n\n### Detailed Explanation\n\n1. `extract_images_from_pdf()`: \n   - Uses `pdfimages` command to extract all images from a PDF\n   - Saves images to a specified directory\n   - Returns list of image paths\n\n2. `create_watermarked_pdf()`:\n   - Uses PyPDF to add a watermark to every page of a PDF\n   - Requires a separate watermark PDF (you'll need to create this)\n\n3. `create_report_with_images()`:\n   - Creates a multi-page PDF report\n   - Adds company logo\n   - Inserts extracted images\n   - Adds captions for images\n\n### What You Need to Prepare\n\n1. A source PDF (`source_document.pdf`)\n2. Company logo (`company_logo.png`)\n3. Watermark PDF (`watermark.pdf`)\n\n### Customization Tips\n\n- Adjust image sizes in `create_report_with_images()`\n- Modify styles using ReportLab's style sheets\n- Add more complex layouts or formatting as needed\n\n### Potential Enhancements\n- Add error handling for missing files\n- Implement logging\n- Add more metadata or headers to the report\n\nWould you like me to elaborate on any part of the script or discuss how to customize it further for your specific needs?",
  "criteria_results": {
    "code_extracted": true,
    "code_compiles": true
  },
  "verification_notes": {
    "code_extracted": "verified",
    "code_compiles": "verified"
  },
  "verification_level": "full",
  "verified_criteria": {
    "passed": 2,
    "total": 2
  },
  "passed": true,
  "tokens": {
    "input": 2308,
    "output": 1630,
    "total": 3938
  },
  "execution_time": 24.37035083770752,
  "error": null,
  "timestamp": "2026-01-01T19:16:10.593720"
}