{
  "task_id": "pdf_hard_1",
  "prompt": "I have a bunch of scanned invoices that are just images in PDF format. I need to extract all the text from them to build a database of invoice data.",
  "difficulty": "hard",
  "model": "claude-3-5-haiku-20241022",
  "response": "I'll provide a comprehensive Python script to extract text from scanned PDF invoices using OCR (Optical Character Recognition). This solution uses several libraries to handle the process effectively:\n\n```python\nimport os\nimport csv\nimport pytesseract\nfrom pdf2image import convert_from_path\nfrom typing import List, Dict\n\nclass InvoiceTextExtractor:\n    def __init__(self, input_dir: str, output_dir: str):\n        \"\"\"\n        Initialize the invoice text extractor\n        \n        Args:\n            input_dir (str): Directory containing scanned invoice PDFs\n            output_dir (str): Directory to save extracted text and CSV\n        \"\"\"\n        self.input_dir = input_dir\n        self.output_dir = output_dir\n        \n        # Create output directory if it doesn't exist\n        os.makedirs(output_dir, exist_ok=True)\n        \n        # Ensure Tesseract is configured (may need path adjustment)\n        pytesseract.pytesseract.tesseract_cmd = r'/usr/bin/tesseract'  # Adjust path as needed\n\n    def extract_text_from_pdf(self, pdf_path: str) -> str:\n        \"\"\"\n        Extract text from a single scanned PDF using OCR\n        \n        Args:\n            pdf_path (str): Path to the PDF file\n        \n        Returns:\n            str: Extracted text from the PDF\n        \"\"\"\n        try:\n            # Convert PDF to images\n            images = convert_from_path(pdf_path, 300)  # 300 DPI for good quality\n            \n            # Extract text from each page\n            full_text = \"\"\n            for i, image in enumerate(images):\n                # Save temporary image\n                temp_image_path = os.path.join(self.output_dir, f'temp_page_{i}.png')\n                image.save(temp_image_path, 'PNG')\n                \n                # Perform OCR\n                page_text = pytesseract.image_to_string(temp_image_path, lang='eng')\n                full_text += page_text + \"\\n\\n\"\n                \n                # Remove temporary image\n                os.remove(temp_image_path)\n            \n            return full_text\n        \n        except Exception as e:\n            print(f\"Error extracting text from {pdf_path}: {e}\")\n            return \"\"\n\n    def batch_extract_invoices(self) -> List[Dict[str, str]]:\n        \"\"\"\n        Extract text from all PDFs in the input directory\n        \n        Returns:\n            List of dictionaries with invoice details\n        \"\"\"\n        invoice_data = []\n        \n        # Iterate through all PDFs in input directory\n        for filename in os.listdir(self.input_dir):\n            if filename.lower().endswith('.pdf'):\n                pdf_path = os.path.join(self.input_dir, filename)\n                \n                # Extract text\n                extracted_text = self.extract_text_from_pdf(pdf_path)\n                \n                # Create invoice entry\n                invoice_entry = {\n                    'filename': filename,\n                    'full_text': extracted_text\n                }\n                invoice_data.append(invoice_entry)\n                \n                # Optionally save individual text files\n                text_output_path = os.path.join(\n                    self.output_dir, \n                    f'{os.path.splitext(filename)[0]}_extracted.txt'\n                )\n                with open(text_output_path, 'w', encoding='utf-8') as f:\n                    f.write(extracted_text)\n        \n        return invoice_data\n\n    def save_to_csv(self, invoice_data: List[Dict[str, str]]):\n        \"\"\"\n        Save extracted invoice data to a CSV file\n        \n        Args:\n            invoice_data (List[Dict]): List of invoice data dictionaries\n        \"\"\"\n        csv_path = os.path.join(self.output_dir, 'invoice_extraction_results.csv')\n        \n        # Write to CSV\n        with open(csv_path, 'w', newline='', encoding='utf-8') as csvfile:\n            fieldnames = ['filename', 'full_text']\n            writer = csv.DictWriter(csvfile, fieldnames=fieldnames)\n            \n            writer.writeheader()\n            for entry in invoice_data:\n                writer.writerow(entry)\n        \n        print(f\"CSV saved to {csv_path}\")\n\ndef main():\n    # Configure input and output directories\n    input_dir = './scanned_invoices'  # Directory with PDF invoices\n    output_dir = './extracted_invoices'  # Where to save extracted text\n    \n    # Create extractor\n    extractor = InvoiceTextExtractor(input_dir, output_dir)\n    \n    # Extract invoice texts\n    invoice_data = extractor.batch_extract_invoices()\n    \n    # Save to CSV\n    extractor.save_to_csv(invoice_data)\n\nif __name__ == '__main__':\n    main()\n```\n\n### Prerequisites\n\nBefore running this script, you'll need to install these libraries:\n\n```bash\npip install pytesseract pdf2image Pillow\n```\n\nYou'll also need to install:\n1. Tesseract OCR (system-level installation)\n   - On Ubuntu: `sudo apt-get install tesseract-ocr`\n   - On macOS: `brew install tesseract`\n   - On Windows: Download from official Tesseract GitHub\n\n2. Poppler (for pdf2image)\n   - On Ubuntu: `sudo apt-get install poppler-utils`\n   - On macOS: `brew install poppler`\n   - On Windows: Download and add to PATH\n\n### Key Features\n- Batch process multiple scanned PDF invoices\n- Extract text using high-quality OCR\n- Save individual text files\n- Generate a comprehensive CSV with extracted text\n- Error handling for problematic PDFs\n- Configurable input/output directories\n\n### Customization Tips\n- Adjust `pytesseract.pytesseract.tesseract_cmd` to match your Tesseract installation path\n- Modify OCR resolution (currently 300 DPI) as needed\n- Add more sophisticated text parsing if you want to extract specific invoice details\n\n### Potential Improvements\n- Add more robust text cleaning\n- Implement specific invoice data extraction (totals, dates, etc.)\n- Add support for multiple languages\n- Implement more advanced error handling\n\n### Recommendations\n- Test with a small batch of invoices first\n- Verify OCR quality and adjust settings as needed\n- Consider manual review for critical financial documents\n\nWould you like me to elaborate on any part of the script or discuss potential enhancements for your specific use case?",
  "criteria_results": {
    "code_extracted": true,
    "code_compiles": true
  },
  "verification_notes": {
    "code_extracted": "verified",
    "code_compiles": "verified"
  },
  "verification_level": "full",
  "verified_criteria": {
    "passed": 2,
    "total": 2
  },
  "passed": true,
  "tokens": {
    "input": 2304,
    "output": 1599,
    "total": 3903
  },
  "execution_time": 23.63257384300232,
  "error": null,
  "timestamp": "2026-01-01T19:16:10.593220"
}