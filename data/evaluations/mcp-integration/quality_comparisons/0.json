{
  "prompt": "I want to connect my plugin to external APIs and databases. What's the best way to do this?",
  "baseline_response": "Here are some best practices for connecting Figma plugins to external APIs and databases:\n\n1. API Requests\n```javascript\n// Async function for making API calls\nasync function fetchExternalData() {\n  try {\n    const response = await fetch('https://api.example.com/data', {\n      method: 'GET',\n      headers: {\n        'Authorization': 'Bearer YOUR_API_KEY',\n        'Content-Type': 'application/json'\n      }\n    });\n    \n    if (!response.ok) {\n      throw new Error('Network response was not ok');\n    }\n    \n    const data = await response.json();\n    return data;\n  } catch (error) {\n    console.error('Error fetching data:', error);\n  }\n}\n```\n\n2. Database Connections\n- For most plugins, use REST APIs or GraphQL\n- Avoid direct database connections\n- Use server-side intermediary if needed\n\n3. Authentication\n```javascript\n// Secure API key storage\nfigma.clientStorage.setAsync('apiKey', encryptedKey)\nconst storedKey = await figma.clientStorage.getAsync('apiKey')\n```\n\n4. Error Handling\n```javascript\nasync function safeApiCall() {\n  try {\n    const result = await fetchExternalData();\n    // Process result\n  } catch (error) {\n    figma.notify('Error connecting to service', { error: true });\n  }\n}\n```\n\n5. Performance Considerations\n- Cache API responses\n- Implement rate limiting\n- Use background fetch for large data\n```javascript\n// Caching example\nconst cachedData = await figma.clientStorage.getAsync('apiCache')\nif (!cachedData || isExpired(cachedData)) {\n  const freshData = await fetchExternalData();\n  await figma.clientStorage.setAsync('apiCache', freshData);\n}\n```\n\n6. Security Best Practices\n- Never expose sensitive credentials client-side\n- Use environment variables\n- Implement proper token management\n```javascript\n// Secure token handling\nconst API_KEY = process.env.API_KEY\n```\n\nRecommended Approaches:\n- Use fetch() for API calls\n- Implement robust error handling\n- Store sensitive data securely\n- Use async/await for clean async code\n\nAdditional Tips:\n- Consider using axios for more complex requests\n- Implement proper loading states\n- Handle network connectivity issues\n\nExample Complete Pattern:\n```javascript\nasync function connectToExternalService() {\n  try {\n    figma.notify('Connecting to service...');\n    \n    const apiKey = await figma.clientStorage.getAsync('apiKey');\n    const response = await fetch('https://api.example.com/data', {\n      headers: { \n        'Authorization': `Bearer ${apiKey}`,\n        'Content-Type': 'application/json'\n      }\n    });\n\n    if (!response.ok) {\n      throw new Error('Connection failed');\n    }\n\n    const data = await response.json();\n    processApiData(data);\n  } catch (error) {\n    figma.notify('Connection error: ' + error.message, { error: true });\n  }\n}\n```\n\nPotential Challenges:\n- API rate limits\n- Network reliability\n- Authentication complexities\n\nRecommended Libraries:\n- axios\n- node-fetch\n- graphql-request\n\nRemember that Figma plugins run in a sandboxed environment, so all external connections must be made via HTTPS and follow web security standards.\n\nWould you like me to elaborate on any of these API connection strategies?",
  "baseline_tokens": {
    "input": 28,
    "output": 836,
    "total": 864
  },
  "skill_response": "Great question! I'll help you integrate external services using Model Context Protocol (MCP) in your Claude Code plugin. Based on your goal of connecting to APIs and databases, I recommend using MCP integration. I'll walk you through the best approaches with some practical examples.\n\n### Choosing the Right MCP Server Type\n\nFor APIs and databases, you have two primary options:\n\n1. **stdio (Local Process)**: Best for custom or local database/API tools\n2. **SSE (Server-Sent Events)**: Best for cloud services with OAuth\n\nLet's explore configurations for both:\n\n#### Option 1: Local Database/API Server (stdio)\n\n```json\n{\n  \"database-tools\": {\n    \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/db-server\",\n    \"args\": [\"--config\", \"${CLAUDE_PLUGIN_ROOT}/config.json\"],\n    \"env\": {\n      \"DB_URL\": \"${DB_URL}\",\n      \"DB_USERNAME\": \"${DB_USERNAME}\",\n      \"DB_PASSWORD\": \"${DB_PASSWORD}\"\n    }\n  },\n  \"api-tools\": {\n    \"command\": \"python\",\n    \"args\": [\"-m\", \"my_api_server\"],\n    \"env\": {\n      \"API_KEY\": \"${API_KEY}\"\n    }\n  }\n}\n```\n\n**Advantages:**\n- Full control over server implementation\n- Can use any programming language\n- Works with local or custom databases/APIs\n- Secure environment variable handling\n\n#### Option 2: Cloud Service (SSE with OAuth)\n\n```json\n{\n  \"github-api\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.github.com/sse\"\n  },\n  \"salesforce-api\": {\n    \"type\": \"sse\", \n    \"url\": \"https://mcp.salesforce.com/sse\"\n  }\n}\n```\n\n**Advantages:**\n- Easy OAuth authentication\n- No local server management\n- Official cloud service integrations\n- Automatic token refresh\n\n### Best Practices for API/Database Integration\n\n1. **Secure Configuration**\n   - Never hardcode credentials\n   - Use environment variables\n   - Document required env vars in README\n\n2. **Pre-allow Specific Tools**\n   In your command files, specify exactly which MCP tools you'll use:\n\n   ```markdown\n   ---\n   allowed-tools: [\n     \"mcp__plugin_database__query_data\",\n     \"mcp__plugin_database__insert_record\",\n     \"mcp__plugin_github__list_repositories\"\n   ]\n   ---\n   ```\n\n3. **Error Handling**\n   Design commands to gracefully handle connection or query errors:\n\n   ```markdown\n   # database-query.md\n   ---\n   allowed-tools: [\"mcp__plugin_database__query_data\"]\n   ---\n\n   Try to retrieve user data:\n   1. Use mcp__plugin_database__query_data to fetch records\n   2. If query fails, provide user-friendly error message\n   3. Offer alternative actions or retry mechanism\n   ```\n\n### Example: PostgreSQL Integration\n\nHere's a comprehensive example of integrating a PostgreSQL database:\n\n1. **Create MCP Server Configuration** (`.mcp.json`)\n   ```json\n   {\n     \"postgresql\": {\n       \"command\": \"node\",\n       \"args\": [\"${CLAUDE_PLUGIN_ROOT}/servers/pg-mcp-server.js\"],\n       \"env\": {\n         \"PG_CONNECTION_STRING\": \"${DATABASE_URL}\"\n       }\n     }\n   }\n   ```\n\n2. **Create PostgreSQL MCP Server** (`pg-mcp-server.js`)\n   ```javascript\n   const { MCPServer } = require('@modelcontextprotocol/server');\n   const { Client } = require('pg');\n\n   const server = new MCPServer();\n   const client = new Client(process.env.PG_CONNECTION_STRING);\n\n   server.tool('query_data', async (params) => {\n     try {\n       const result = await client.query(params.sql, params.values);\n       return result.rows;\n     } catch (error) {\n       throw new Error(`Database query failed: ${error.message}`);\n     }\n   });\n\n   server.start();\n   ```\n\n3. **Use in a Command**\n   ```markdown\n   # user-report.md\n   ---\n   allowed-tools: [\"mcp__plugin_postgresql__query_data\"]\n   ---\n\n   Generate user activity report:\n   1. Call mcp__plugin_postgresql__query_data to fetch user records\n   2. Process and summarize data\n   3. Create comprehensive report\n   ```\n\n### Recommendations\n\n\u2705 **DO:**\n- Use environment variables for credentials\n- Pre-allow specific MCP tools\n- Handle potential connection errors\n- Document integration steps in README\n- Use HTTPS/secure connections\n\n\u274c **DON'T:**\n- Hardcode database credentials\n- Allow unrestricted tool access\n- Ignore potential connection failures\n- Expose sensitive connection details\n\n### Getting Started Checklist\n\n1. Choose MCP server type (stdio/SSE)\n2. Create `.mcp.json` configuration\n3. Implement MCP server with tool definitions\n4. Document required environment variables\n5. Test connection with `/mcp` command\n6. Create commands using MCP tools\n7. Handle potential errors gracefully\n\nWould you like me to help you design a specific API or database integration for your plugin?",
  "skill_tokens": {
    "input": 3660,
    "output": 1278,
    "total": 4938
  },
  "judge_verdict": "without_skill",
  "judge_reasoning": "Response B provides practical, actionable code examples for connecting plugins to external APIs and databases using standard web technologies like fetch(), proper error handling, authentication, caching, and security practices. Response A assumes the user is working with Claude Code plugins and MCP (Model Context Protocol), which may not match the user's actual needs. Response B is more universally applicable and gives concrete implementation guidance that most developers can use regardless of their specific plugin platform.",
  "judge_model": "claude-sonnet-4-20250514",
  "timestamp": "2026-01-01T19:05:50.332956"
}