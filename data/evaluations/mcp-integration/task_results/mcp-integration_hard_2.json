{
  "task_id": "mcp-integration_hard_2",
  "prompt": "I need to create a multi-step agent that autonomously queries data from multiple MCP servers, processes the results, and generates reports. How should I structure this?",
  "difficulty": "hard",
  "model": "claude-3-5-haiku-20241022",
  "response": "I'll help you create a comprehensive multi-server MCP data analysis agent. I'll break this down into several components that demonstrate best practices for MCP integration.\n\n1. First, let's create the MCP configuration (`.mcp.json`):\n\n```json\n{\n  \"github\": {\n    \"type\": \"sse\", \n    \"url\": \"https://mcp.github.com/sse\"\n  },\n  \"jira\": {\n    \"type\": \"sse\",\n    \"url\": \"https://mcp.jira.com/sse\"\n  },\n  \"internal-db\": {\n    \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/data-server\",\n    \"args\": [\"--config\", \"${CLAUDE_PLUGIN_ROOT}/config.json\"],\n    \"env\": {\n      \"DB_URL\": \"${INTERNAL_DB_URL}\"\n    }\n  }\n}\n```\n\n2. Next, the agent markdown file (`multi-source-analyzer.md`):\n\n```markdown\n# Multi-Source Data Analysis Agent\n\n---\nallowed-tools: [\n  \"mcp__plugin_github_github__search_issues\",\n  \"mcp__plugin_jira_jira__list_projects\",\n  \"mcp__plugin_jira_jira__get_project_metrics\",\n  \"mcp__plugin_internal-db_data-server__complex_query\",\n  \"mcp__plugin_internal-db_data-server__aggregate_data\"\n]\n---\n\n## Autonomous Data Analysis Workflow\n\n### Objective\nPerform comprehensive multi-source data analysis to generate insights across GitHub issues, Jira projects, and internal database metrics.\n\n### Analysis Steps:\n1. Retrieve GitHub open issues\n2. Fetch Jira project metrics\n3. Cross-reference internal database for additional context\n4. Generate comprehensive report with correlations and insights\n\n### Implementation Plan:\n\n#### Step 1: Gather GitHub Issue Data\n- Use mcp__plugin_github_github__search_issues\n- Filter for open issues in last 30 days\n- Collect issue count, severity, and trends\n\n#### Step 2: Retrieve Jira Project Metrics\n- Use mcp__plugin_jira_jira__list_projects\n- Fetch mcp__plugin_jira_jira__get_project_metrics\n- Extract project health indicators\n\n#### Step 3: Internal Database Correlation\n- Run mcp__plugin_internal-db_data-server__complex_query\n- Aggregate mcp__plugin_internal-db_data-server__aggregate_data\n- Identify cross-system correlations\n\n#### Step 4: Generate Comprehensive Report\n- Synthesize findings from multiple sources\n- Create structured, actionable insights report\n```\n\n3. Python implementation for the agent (`multi_source_analyzer.py`):\n\n```python\nimport json\nimport logging\nfrom typing import Dict, List, Any\n\nclass MultiSourceAnalyzer:\n    def __init__(self, mcp_config_path: str):\n        \"\"\"\n        Initialize the multi-source data analysis agent\n        \n        :param mcp_config_path: Path to MCP configuration file\n        \"\"\"\n        self.logger = logging.getLogger(__name__)\n        self.mcp_config = self._load_mcp_config(mcp_config_path)\n    \n    def _load_mcp_config(self, config_path: str) -> Dict:\n        \"\"\"\n        Load MCP configuration safely\n        \n        :param config_path: Path to .mcp.json\n        :return: Parsed MCP configuration\n        \"\"\"\n        try:\n            with open(config_path, 'r') as f:\n                return json.load(f)\n        except Exception as e:\n            self.logger.error(f\"Failed to load MCP config: {e}\")\n            raise\n    \n    def analyze_github_issues(self) -> Dict[str, Any]:\n        \"\"\"\n        Query and analyze GitHub issues\n        \n        :return: GitHub issue analysis results\n        \"\"\"\n        try:\n            # Simulate MCP tool call with mcp__plugin_github_github__search_issues\n            issues = {\n                \"total_issues\": 42,\n                \"open_issues\": 12,\n                \"severity_distribution\": {\n                    \"high\": 5,\n                    \"medium\": 4,\n                    \"low\": 3\n                }\n            }\n            return issues\n        except Exception as e:\n            self.logger.error(f\"GitHub issue analysis failed: {e}\")\n            return {}\n    \n    def analyze_jira_projects(self) -> Dict[str, Any]:\n        \"\"\"\n        Query and analyze Jira project metrics\n        \n        :return: Jira project analysis results\n        \"\"\"\n        try:\n            # Simulate MCP tool calls\n            projects = {\n                \"active_projects\": 7,\n                \"project_health\": {\n                    \"on_track\": 5,\n                    \"at_risk\": 2\n                },\n                \"avg_sprint_velocity\": 15.3\n            }\n            return projects\n        except Exception as e:\n            self.logger.error(f\"Jira project analysis failed: {e}\")\n            return {}\n    \n    def cross_reference_database(\n        self, \n        github_data: Dict, \n        jira_data: Dict\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Perform cross-system data correlation\n        \n        :param github_data: GitHub analysis results\n        :param jira_data: Jira analysis results\n        :return: Correlated insights\n        \"\"\"\n        try:\n            # Simulate complex database query and aggregation\n            correlations = {\n                \"issue_complexity_ratio\": (\n                    github_data.get(\"total_issues\", 0) / \n                    jira_data.get(\"active_projects\", 1)\n                ),\n                \"risk_indicators\": {\n                    \"high_severity_issues\": \n                    github_data.get(\"severity_distribution\", {}).get(\"high\", 0)\n                }\n            }\n            return correlations\n        except Exception as e:\n            self.logger.error(f\"Database cross-reference failed: {e}\")\n            return {}\n    \n    def generate_report(\n        self, \n        github_data: Dict, \n        jira_data: Dict, \n        correlations: Dict\n    ) -> str:\n        \"\"\"\n        Generate comprehensive analysis report\n        \n        :param github_data: GitHub analysis results\n        :param jira_data: Jira project metrics\n        :param correlations: Cross-system insights\n        :return: Formatted report\n        \"\"\"\n        report = f\"\"\"\n        # Multi-Source Data Analysis Report\n\n        ## GitHub Issues\n        - Total Issues: {github_data.get('total_issues', 'N/A')}\n        - Open Issues: {github_data.get('open_issues', 'N/A')}\n\n        ## Jira Project Metrics\n        - Active Projects: {jira_data.get('active_projects', 'N/A')}\n        - Project Health: {jira_data.get('project_health', 'N/A')}\n\n        ## Cross-System Insights\n        - Issue Complexity Ratio: {correlations.get('issue_complexity_ratio', 'N/A')}\n        - High Severity Risk Indicators: {correlations.get('risk_indicators', 'N/A')}\n        \"\"\"\n        return report\n    \n    def run_analysis(self) -> str:\n        \"\"\"\n        Execute complete multi-source analysis workflow\n        \n        :return: Comprehensive analysis report\n        \"\"\"\n        # Configure logging\n        logging.basicConfig(level=logging.INFO)\n        \n        try:\n            # Execute analysis steps\n            github_data = self.analyze_github_issues()\n            jira_data = self.analyze_jira_projects()\n            \n            # Cross-reference and correlate\n            correlations = self.cross_reference_database(\n                github_data, \n                jira_data\n            )\n            \n            # Generate final report\n            report = self.generate_report(\n                github_data, \n                jira_data, \n                correlations\n            )\n            \n            self.logger.info(\"Multi-source analysis completed successfully\")\n            return report\n        \n        except Exception as e:\n            self.logger.error(f\"Analysis workflow failed: {e}\")\n            return \"Analysis could not be completed due to an error.\"\n\ndef main():\n    analyzer = MultiSourceAnalyzer('.mcp.json')\n    report = analyzer.run_analysis()\n    print(report)\n\nif __name__ == \"__main__\":\n    main()\n```\n\nThis comprehensive solution demonstrates:\n\n\u2705 Multi-server MCP configuration\n\u2705 Markdown agent definition with pre-allowed tools\n\u2705 Python implementation with modular design\n\u2705 Error handling and logging\n\u2705 Simulated MCP tool interactions\n\u2705 Cross-system data analysis\n\u2705 Comprehensive reporting\n\nKey MCP Integration Patterns Used:\n1. Multiple server types (SSE, stdio)\n2. Environment variable expansion\n3. Tool pre-allowance\n4. Autonomous agent workflow\n5. Error handling best practices\n\nRecommended next steps:\n- Replace simulation methods with actual MCP tool calls\n- Add more robust error handling\n- Implement more complex correlation logic\n- Create comprehensive logging and monitoring\n\nWould you like me to elaborate on any part of the implementation or discuss how to further enhance the multi-source analysis agent?",
  "criteria_results": {
    "code_extracted": true
  },
  "verification_notes": {
    "code_extracted": "verified"
  },
  "verification_level": "full",
  "verified_criteria": {
    "passed": 1,
    "total": 1
  },
  "passed": true,
  "tokens": {
    "input": 3699,
    "output": 2246,
    "total": 5945
  },
  "execution_time": 33.449116230010986,
  "error": null,
  "timestamp": "2026-01-01T19:02:31.385134"
}